<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¡¨æ ¼è°ƒè¯•é¡µé¢</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        body {
            font-family: 'Roboto', 'Noto Sans SC', sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 24px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .md3-data-table {
            width: 100%;
            border-collapse: collapse;
            font-family: 'Roboto', 'Noto Sans SC', sans-serif;
            font-size: 14px;
            margin-bottom: 24px;
        }
        .md3-data-table th {
            padding: 16px 12px;
            text-align: left;
            font-weight: 600;
            color: #666;
            border-bottom: 2px solid #e0e0e0;
            background-color: #f8f9fa;
            white-space: nowrap;
            vertical-align: middle;
        }
        .md3-data-table td {
            padding: 12px;
            border-bottom: 1px solid #e0e0e0;
            color: #333;
            vertical-align: middle;
            white-space: nowrap;
        }
        .md3-data-table tr:hover {
            background-color: #f5f5f5;
        }
        .trend-up {
            color: #d32f2f;
            font-weight: 500;
        }
        .trend-down {
            color: #2e7d32;
            font-weight: 500;
        }
        .md3-button {
            padding: 8px 16px;
            border: 1px solid #1976d2;
            background: transparent;
            color: #1976d2;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            margin: 0 2px;
        }
        .debug-info {
            background: #e3f2fd;
            border: 1px solid #2196f3;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 24px;
        }
        .problem-demo {
            background: #ffebee;
            border: 1px solid #f44336;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 24px;
        }
        .solution-demo {
            background: #e8f5e8;
            border: 1px solid #4caf50;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 24px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 style="text-align: center; color: #1976d2; margin-bottom: 32px;">è¡¨æ ¼åˆ—å¯¹é½é—®é¢˜è°ƒè¯•</h1>
        
        <div class="debug-info">
            <h3>ğŸ” é—®é¢˜åˆ†æ</h3>
            <p>æ ¹æ®æ‚¨çš„æˆªå›¾ï¼Œ"æ¶¨è·Œå¹…"åˆ—æ˜¾ç¤ºäº†å¤šè¡Œå†…å®¹ï¼Œè¿™é€šå¸¸æ˜¯ç”±ä»¥ä¸‹åŸå› é€ æˆçš„ï¼š</p>
            <ul>
                <li>æ•°æ®ä¸­åŒ…å«æ¢è¡Œç¬¦ (\n, \r, \t)</li>
                <li>æŸä¸ªå­—æ®µçš„å€¼åŒ…å«äº†å¤šä¸ªæ•°æ®</li>
                <li>HTMLæ¨¡æ¿å­—ç¬¦ä¸²æ ¼å¼é—®é¢˜</li>
                <li>CSSæ ·å¼å†²çª</li>
            </ul>
        </div>

        <div class="problem-demo">
            <h3>âŒ é—®é¢˜æ¼”ç¤º - å¯èƒ½çš„é”™è¯¯æƒ…å†µ</h3>
            <table class="md3-data-table">
                <thead>
                    <tr>
                        <th style="text-align: center;">ä»£ç </th>
                        <th style="text-align: left;">åç§°</th>
                        <th style="text-align: right;">æœ€æ–°ä»·</th>
                        <th style="text-align: center;">æ¶¨è·Œå¹…</th>
                        <th style="text-align: right;">ä¸»åŠ›å‡€æµå…¥</th>
                        <th style="text-align: right;">ä¸»åŠ›å‡€æµå…¥å æ¯”</th>
                        <th style="text-align: center;">æ“ä½œ</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td style="text-align: center;">000001</td>
                        <td style="text-align: left;">å¹³å®‰é“¶è¡Œ</td>
                        <td style="text-align: right;">12.34</td>
                        <td style="text-align: center;">
                            <!-- æ¨¡æ‹Ÿé—®é¢˜ï¼šå¤šè¡Œå†…å®¹ -->
                            <i class="material-icons" style="color: #d32f2f;">arrow_upward</i> 1.23%<br>
                            <i class="material-icons" style="color: #d32f2f;">arrow_upward</i> 12.35äº¿<br>
                            2.34%
                        </td>
                        <td style="text-align: right;">
                            <!-- è¿™é‡Œåº”è¯¥æ˜¾ç¤ºæŒ‰é’®ï¼Œä½†è¢«æŒ¤åˆ°äº†æ¶¨è·Œå¹…åˆ— -->
                            <button class="md3-button">
                                <i class="material-icons">trending_up</i>
                            </button>
                        </td>
                        <td style="text-align: right;"><!-- ç©º --></td>
                        <td style="text-align: center;"><!-- ç©º --></td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="solution-demo">
            <h3>âœ… ä¿®å¤å - æ­£ç¡®çš„è¡¨æ ¼</h3>
            <table class="md3-data-table">
                <thead>
                    <tr>
                        <th style="text-align: center;">ä»£ç </th>
                        <th style="text-align: left;">åç§°</th>
                        <th style="text-align: right;">æœ€æ–°ä»·</th>
                        <th style="text-align: center;">æ¶¨è·Œå¹…</th>
                        <th style="text-align: right;">ä¸»åŠ›å‡€æµå…¥</th>
                        <th style="text-align: right;">ä¸»åŠ›å‡€æµå…¥å æ¯”</th>
                        <th style="text-align: center;">æ“ä½œ</th>
                    </tr>
                </thead>
                <tbody id="test-table">
                    <!-- å°†é€šè¿‡JavaScriptå¡«å…… -->
                </tbody>
            </table>
        </div>

        <div class="debug-info">
            <h3>ğŸ› ï¸ ä¿®å¤æ–¹æ¡ˆ</h3>
            <ol>
                <li><strong>æ•°æ®æ¸…ç†ï¼š</strong>ç§»é™¤æ‰€æœ‰æ¢è¡Œç¬¦å’Œåˆ¶è¡¨ç¬¦</li>
                <li><strong>å•è¡ŒHTMLï¼š</strong>ç¡®ä¿HTMLæ¨¡æ¿ä¸ºå•è¡Œæ ¼å¼</li>
                <li><strong>æ ·å¼æ§åˆ¶ï¼š</strong>æ·»åŠ  white-space: nowrap</li>
                <li><strong>è°ƒè¯•ä¿¡æ¯ï¼š</strong>åœ¨æ§åˆ¶å°æŸ¥çœ‹æ•°æ®ç»“æ„</li>
            </ol>
            <button onclick="testTableRender()" style="background: #4caf50; color: white; border: none; padding: 12px 24px; border-radius: 4px; cursor: pointer; margin-top: 16px;">
                æµ‹è¯•è¡¨æ ¼æ¸²æŸ“
            </button>
        </div>
    </div>

    <script>
        // æ¨¡æ‹Ÿæ•°æ®
        const testData = [
            {
                code: "000001",
                name: "å¹³å®‰é“¶è¡Œ",
                price: 12.34,
                change_percent: 1.23,
                main_net_inflow: 1234567890,
                main_net_inflow_percent: 2.34
            },
            {
                code: "000002",
                name: "ä¸‡ç§‘A",
                price: 23.45,
                change_percent: -0.87,
                main_net_inflow: -987654321,
                main_net_inflow_percent: -1.56
            }
        ];

        function formatNumber(value, decimals = 2) {
            return parseFloat(value).toFixed(decimals);
        }

        function formatPercent(value) {
            return parseFloat(value).toFixed(2) + '%';
        }

        function formatMoney(value) {
            value = parseFloat(value);
            if (Math.abs(value) >= 1e8) {
                return (value / 1e8).toFixed(2) + ' äº¿';
            } else if (Math.abs(value) >= 1e4) {
                return (value / 1e4).toFixed(2) + ' ä¸‡';
            } else {
                return value.toFixed(2) + ' å…ƒ';
            }
        }

        function testTableRender() {
            console.log('å¼€å§‹æµ‹è¯•è¡¨æ ¼æ¸²æŸ“...');
            
            let html = '';
            testData.forEach((item, index) => {
                console.log(`å¤„ç†æ•°æ® ${index}:`, item);

                // æ•°æ®æ¸…ç†
                const cleanCode = String(item.code || '').trim().replace(/[\r\n\t]/g, '');
                const cleanName = String(item.name || '').trim().replace(/[\r\n\t]/g, '');
                const cleanPrice = parseFloat(item.price) || 0;
                const cleanChangePercent = parseFloat(item.change_percent) || 0;
                const cleanMainNetInflow = parseFloat(item.main_net_inflow) || 0;
                const cleanMainNetInflowPercent = parseFloat(item.main_net_inflow_percent) || 0;

                console.log(`æ¸…ç†åæ•°æ® ${index}:`, {
                    cleanCode, cleanName, cleanPrice, cleanChangePercent, 
                    cleanMainNetInflow, cleanMainNetInflowPercent
                });

                // é¢œè‰²å’Œå›¾æ ‡
                const changeClass = cleanChangePercent >= 0 ? 'trend-up' : 'trend-down';
                const changeIcon = cleanChangePercent >= 0 ? 
                    '<i class="material-icons" style="color: #d32f2f;">arrow_upward</i>' : 
                    '<i class="material-icons" style="color: #2e7d32;">arrow_downward</i>';

                const netFlowClass = cleanMainNetInflow >= 0 ? 'trend-up' : 'trend-down';
                const netFlowIcon = cleanMainNetInflow >= 0 ? 
                    '<i class="material-icons" style="color: #d32f2f;">arrow_upward</i>' : 
                    '<i class="material-icons" style="color: #2e7d32;">arrow_downward</i>';

                // å•è¡ŒHTMLæ„å»º
                const rowHtml = `<tr><td style="text-align: center; white-space: nowrap;">${cleanCode}</td><td style="text-align: left; white-space: nowrap;">${cleanName}</td><td style="text-align: right; white-space: nowrap;">${formatNumber(cleanPrice, 2)}</td><td class="${changeClass}" style="text-align: center; white-space: nowrap;">${changeIcon} ${formatPercent(cleanChangePercent)}</td><td class="${netFlowClass}" style="text-align: right; white-space: nowrap;">${netFlowIcon} ${formatMoney(cleanMainNetInflow)}</td><td class="${netFlowClass}" style="text-align: right; white-space: nowrap;">${formatPercent(cleanMainNetInflowPercent)}</td><td style="text-align: center; white-space: nowrap;"><button class="md3-button" style="margin-right: 4px;"><i class="material-icons">trending_up</i></button><button class="md3-button"><i class="material-icons">account_balance</i></button></td></tr>`;

                html += rowHtml;
            });

            console.log('æœ€ç»ˆHTML:', html);
            document.getElementById('test-table').innerHTML = html;
            console.log('è¡¨æ ¼æ¸²æŸ“å®Œæˆï¼');
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æµ‹è¯•
        document.addEventListener('DOMContentLoaded', function() {
            testTableRender();
        });
    </script>
</body>
</html>
